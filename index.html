<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Annas Chat - Versi Keren</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    /* Your existing CSS (as provided in your previous message) goes here */
    /* Make sure to include the new chat bubble CSS I provided previously */

    /* Add this for basic message bubbles if not already present */
    #chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px; /* Space between bubbles */
        background: url('https://i.ibb.co/L9p6qL0/chat-bg.jpg') no-repeat center center / cover; /* Example background, replace with your own or remove */
        position: relative;
        min-height: 0;
    }

    .message-bubble {
        max-width: 80%;
        padding: 12px 18px;
        border-radius: 20px;
        position: relative;
        font-size: 0.95em;
        word-wrap: break-word;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255,255,255,0.05);
    }

    .message-bubble.sent {
        align-self: flex-end;
        background-color: var(--bubble-sent);
        color: var(--text-light);
        border-bottom-right-radius: 5px;
    }

    .message-bubble.received {
        align-self: flex-start;
        background-color: var(--bubble-received);
        color: var(--text-light);
        border-bottom-left-radius: 5px;
    }

    .message-bubble.info {
        align-self: center;
        background-color: rgba(111, 66, 193, 0.15);
        color: var(--accent-purple);
        font-size: 0.85em;
        text-align: center;
        max-width: 90%;
        margin: 5px auto;
        border-radius: 15px;
        padding: 8px 15px;
        font-style: italic;
        box-shadow: none;
        border: 1px solid rgba(111, 66, 193, 0.3);
    }

    .message-bubble .message-sender {
        display: block;
        font-size: 0.75em;
        font-weight: 600;
        margin-bottom: 5px;
        opacity: 0.8;
        color: var(--text-light);
    }
    .message-bubble.received .message-sender {
        color: #9D6EFD;
    }

    .message-bubble .message-timestamp {
        display: block;
        font-size: 0.7em;
        color: var(--text-muted);
        margin-top: 5px;
        text-align: right;
        opacity: 0.7;
    }

    /* Chat input area */
    #chat-input-area {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        background: var(--secondary-dark);
        border-top: 1px solid var(--border-color);
        box-shadow: 0 -5px 15px rgba(0,0,0,0.3);
        flex-shrink: 0;
        gap: 10px;
    }
    #chat-input-area textarea {
        flex-grow: 1;
        min-height: 25px;
        max-height: 120px;
        height: auto;
        padding: 12px 15px;
        margin: 0;
        border-radius: 25px;
        background-color: var(--accent-blue);
        border: 1px solid var(--border-color);
        color: var(--text-light);
        font-size: 1em;
        resize: none;
        overflow-y: auto;
    }
    #chat-input-area textarea:focus {
        border-color: var(--accent-purple);
        box-shadow: 0 0 0 4px rgba(111, 66, 193, 0.2);
    }
    #chat-input-area .icon-btn {
        background: none;
        border: none;
        color: var(--text-muted);
        font-size: 1.6em;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        transition: color 0.2s ease, background-color 0.2s ease;
        width: auto;
        margin: 0;
        box-shadow: none;
        flex-shrink: 0;
    }
    #chat-input-area .icon-btn:hover {
        color: var(--accent-purple);
        background-color: rgba(111, 66, 193, 0.1);
        transform: none;
    }
    #chat-input-area #send-message-btn {
        background: linear-gradient(45deg, var(--accent-purple), #9D6EFD);
        color: var(--text-light);
        width: 50px;
        height: 50px;
        font-size: 1.3em;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        transition: background 0.3s ease, transform 0.2s ease;
        flex-shrink: 0;
    }
    #chat-input-area #send-message-btn:hover {
        background: linear-gradient(45deg, #9D6EFD, var(--accent-purple));
        transform: scale(1.05);
        box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    }

    /* Styles for Call Screen */
    #call-screen {
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: linear-gradient(135deg, #0A0A0A, #16213E);
        color: var(--text-light);
    }
    #call-screen .call-info {
        text-align: center;
        margin-bottom: 50px;
    }
    #call-screen .call-info .call-avatar {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        background-color: var(--accent-blue);
        margin: 0 auto 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 3em;
        font-weight: 700;
        overflow: hidden;
        border: 5px solid rgba(255,255,255,0.3);
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    #call-screen .call-info .call-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    #call-screen .call-info h2 {
        font-size: 2.5em;
        margin-bottom: 10px;
        color: var(--accent-purple);
    }
    #call-screen .call-info p {
        font-size: 1.2em;
        color: var(--text-muted);
    }
    #call-screen .call-controls {
        display: flex;
        gap: 30px;
    }
    #call-screen .call-controls button {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        border: none;
        background-color: rgba(255,255,255,0.1);
        color: var(--text-light);
        font-size: 2em;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        transition: background-color 0.3s ease, transform 0.2s ease;
    }
    #call-screen .call-controls button:hover {
        background-color: rgba(255,255,255,0.2);
        transform: scale(1.05);
    }
    #call-screen .call-controls .end-call {
        background-color: var(--danger-color);
    }
    #call-screen .call-controls .end-call:hover {
        background-color: #e65252;
    }

    /* Styles for Status Screen */
    #status-screen {
        flex-direction: column;
        background: var(--primary-dark);
        padding: 20px;
    }
    #status-screen .status-header {
        display: flex;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
    }
    #status-screen .status-header .my-status-avatar {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        background-color: var(--accent-blue);
        margin-right: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        color: var(--text-light);
        font-size: 1.8em;
        font-weight: 600;
        position: relative;
        overflow: hidden;
        border: 3px solid var(--accent-purple); /* Highlight for own status */
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    #status-screen .status-header .my-status-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    #status-screen .status-header .my-status-avatar .add-status-icon {
        position: absolute;
        bottom: 0;
        right: 0;
        background-color: var(--success-color);
        color: white;
        border-radius: 50%;
        width: 25px;
        height: 25px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 0.8em;
        border: 2px solid var(--primary-dark);
        cursor: pointer;
        transition: transform 0.2s ease;
    }
    #status-screen .status-header .my-status-avatar .add-status-icon:hover {
        transform: scale(1.1);
    }
    #status-screen .status-header .status-text h3 {
        font-size: 1.5em;
        margin-bottom: 5px;
        color: var(--text-light);
    }
    #status-screen .status-header .status-text p {
        font-size: 0.9em;
        color: var(--text-muted);
    }

    #status-list {
        flex: 1;
        overflow-y: auto;
    }
    .status-section-title {
        font-size: 1.1em;
        color: var(--text-muted);
        margin: 20px 0 10px;
        padding-left: 5px;
        font-weight: 600;
    }
    .status-item {
        display: flex;
        align-items: center;
        padding: 10px 5px;
        cursor: pointer;
        transition: background-color 0.2s ease;
        border-radius: 10px;
    }
    .status-item:hover {
        background-color: rgba(255,255,255,0.08);
    }
    .status-item .status-avatar {
        width: 55px;
        height: 55px;
        border-radius: 50%;
        background-color: var(--accent-blue);
        margin-right: 15px;
        display: flex;
        justify-content: center;
        align-items: center;
        color: var(--text-light);
        font-weight: 600;
        font-size: 1.2em;
        overflow: hidden;
        position: relative;
        border: 2px solid var(--text-muted); /* Default border for viewed status */
    }
    .status-item .status-avatar.unseen {
        border-color: var(--accent-purple); /* Highlight for unseen status */
        border-width: 3px;
    }
    .status-item .status-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .status-item .status-info {
        flex-grow: 1;
    }
    .status-item .status-info .status-name {
        font-weight: 700;
        font-size: 1.1em;
        color: var(--text-light);
    }
    .status-item .status-info .status-time {
        font-size: 0.85em;
        color: var(--text-muted);
    }

    /* Admin Control Screen */
    #admin-control-screen {
        flex-direction: column;
        background: var(--primary-dark);
        padding: 20px;
    }
    #admin-control-screen h2 {
        font-size: 1.8em;
        color: var(--accent-purple);
        margin-bottom: 25px;
        text-align: center;
    }
    .admin-section {
        background: var(--secondary-dark);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        border: 1px solid var(--border-color);
    }
    .admin-section h3 {
        font-size: 1.3em;
        color: var(--text-light);
        margin-bottom: 15px;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        padding-bottom: 10px;
    }
    .admin-list {
        max-height: 250px;
        overflow-y: auto;
        margin-bottom: 15px;
    }
    .admin-list-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px dotted rgba(255,255,255,0.05);
    }
    .admin-list-item:last-child {
        border-bottom: none;
    }
    .admin-list-item .user-info {
        display: flex;
        align-items: center;
    }
    .admin-list-item .user-info .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: var(--accent-blue);
        margin-right: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        color: var(--text-light);
        font-size: 1em;
        flex-shrink: 0;
        overflow: hidden;
    }
    .admin-list-item .user-info .username {
        font-weight: 600;
        color: var(--text-light);
    }
    .admin-list-item .admin-actions button {
        background: none;
        border: 1px solid var(--danger-color);
        color: var(--danger-color);
        padding: 8px 12px;
        border-radius: 10px;
        font-size: 0.9em;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-left: 10px;
        box-shadow: none; /* Override default button style */
    }
    .admin-list-item .admin-actions button.promote {
        border-color: var(--success-color);
        color: var(--success-color);
    }
    .admin-list-item .admin-actions button:hover {
        background-color: var(--danger-color);
        color: white;
        transform: translateY(-2px);
    }
    .admin-list-item .admin-actions button.promote:hover {
        background-color: var(--success-color);
        color: white;
    }
    .admin-form label {
        display: block;
        margin-bottom: 8px;
        color: var(--text-muted);
        font-size: 0.9em;
    }
    .admin-form input, .admin-form select {
        width: calc(100% - 22px); /* Adjust for padding */
        padding: 10px 10px;
        margin-bottom: 15px;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        background-color: var(--accent-blue);
        color: var(--text-light);
        font-size: 1em;
    }
    .admin-form button {
        margin-top: 10px;
        background: var(--accent-purple);
        padding: 12px 20px;
        font-size: 1em;
        border-radius: 10px;
    }
    .admin-form button:hover {
        transform: translateY(-3px);
    }

  </style>
</head>
<body>

  <div id="loading-screen" class="app-screen show">
    <div class="hacker-console"></div>
    <div class="person-walk"></div>
  </div>

  <div id="auth-screen" class="app-screen">
    <div class="card">
      <h2 id="auth-title">Login</h2>
      <input type="text" id="username" placeholder="Username" />
      <input type="password" id="password" placeholder="Password" />
      <button id="auth-submit-btn">Login</button>
      <p class="link" id="toggle-auth">Belum punya akun? Daftar di sini</p>
      <p class="message" id="auth-message" style="display: none;"></p>
    </div>
  </div>

  <div id="main-chat-list-screen" class="app-screen">
    <div id="main-chat-list-header">
      <span class="app-title">Annas Chat</span>
      <div class="header-icons">
        <i class="fas fa-search"></i>
        <i class="fas fa-ellipsis-v"></i>
      </div>
    </div>
    <div id="promo-banner">
      <span>Mulai percakapan baru dengan Annas!</span>
      <button class="close-btn">&times;</button>
    </div>
    <div id="chat-list-content">
      </div>
    <div id="fab-chat"><i class="fas fa-comment-dots"></i></div>
    </div>

  <div id="individual-chat-screen" class="app-screen">
    <div id="chat-header">
      <button class="back-btn" id="back-to-chats"><i class="fas fa-arrow-left"></i></button>
      <div class="chat-partner-avatar" id="chat-partner-avatar-display"></div>
      <div class="chat-partner-info">
        <div class="chat-partner-name" id="chat-partner-name-display"></div>
        <div class="chat-partner-status" id="chat-partner-status-display">Online</div>
      </div>
      <div class="chat-options">
        <button class="icon-btn" id="call-btn"><i class="fas fa-video"></i></button>
        <button class="icon-btn"><i class="fas fa-phone-alt"></i></button>
        <button class="icon-btn"><i class="fas fa-ellipsis-v"></i></button>
      </div>
    </div>

    <div id="chat-messages">
      </div>

    <div id="chat-input-area">
      <button class="icon-btn"><i class="fas fa-grin"></i></button>
      <textarea id="chat-input" placeholder="Pesan"></textarea>
      <button class="icon-btn"><i class="fas fa-paperclip"></i></button>
      <button class="icon-btn"><i class="fas fa-camera"></i></button>
      <button id="send-message-btn"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>

  <div id="call-screen" class="app-screen">
    <div class="call-info">
        <div class="call-avatar" id="calling-avatar"></div>
        <h2 id="calling-name">Memanggil...</h2>
        <p id="call-status">Menghubungkan...</p>
    </div>
    <div class="call-controls">
        <button><i class="fas fa-microphone-slash"></i></button>
        <button><i class="fas fa-volume-up"></i></button>
        <button class="end-call" id="end-call-btn"><i class="fas fa-phone-slash"></i></button>
    </div>
  </div>

  <div id="status-screen" class="app-screen">
    <div class="status-header">
        <div class="my-status-avatar">
            <span>AZ</span> <div class="add-status-icon"><i class="fas fa-plus"></i></div>
        </div>
        <div class="status-text">
            <h3>Status Saya</h3>
            <p>Ketuk untuk memperbarui status</p>
        </div>
    </div>

    <div class="status-section-title">Pembaruan Terbaru</div>
    <div id="status-list">
        </div>
  </div>

  <div id="admin-control-screen" class="app-screen">
      <div id="admin-header">
            <button class="back-btn" id="back-from-admin"><i class="fas fa-arrow-left"></i></button>
            <h2 class="app-title" style="flex-grow: 1; text-align: center;">Kontrol Admin</h2>
            <div style="width: 2em;"></div> </div>
      <div class="admin-section">
          <h3>Manajemen Pengguna</h3>
          <div class="admin-list" id="user-management-list">
              </div>
          <div class="admin-form">
              <label for="new-user-username">Tambah Pengguna Baru:</label>
              <input type="text" id="new-user-username" placeholder="Username" />
              <input type="password" id="new-user-password" placeholder="Password" />
              <button id="add-user-btn">Tambah Pengguna</button>
          </div>
      </div>

      <div class="admin-section">
          <h3>Statistik Aplikasi (Simulasi)</h3>
          <p>Total Pengguna: <span id="total-users-stat">0</span></p>
          <p>Pesan Terkirim Hari Ini: <span id="messages-today-stat">0</span></p>
          <p>Panggilan Berlangsung: <span id="active-calls-stat">0</span></p>
      </div>
  </div>

  <div id="bottom-nav">
    <div class="nav-item active" data-screen="main-chat-list-screen">
      <i class="fas fa-comment"></i>
      <span>Chat</span>
    </div>
    <div class="nav-item" data-screen="call-screen-nav">
      <i class="fas fa-phone"></i>
      <span>Panggilan</span>
    </div>
    <div class="nav-item" data-screen="status-screen">
      <i class="fas fa-circle-notch"></i>
      <span>Status</span>
    </div>
    <div class="nav-item" data-screen="admin-control-screen" id="admin-nav-item">
      <i class="fas fa-user-shield"></i>
      <span>Admin</span>
    </div>
  </div>

  <script>
    // --- Global State / Data (Simplified for client-side demo) ---
    // User data, mimicking a simple database
    let users = [
        { id: 'u001', username: 'Annas', password: '123', isAdmin: true, statusMessage: 'Aktif dan siap membantu!', avatar: null },
        { id: 'u002', username: 'Royalty', password: '123', isAdmin: false, statusMessage: '☕ Ngoding santai...', avatar: null },
        { id: 'u003', username: 'Dlimas Alfiansyah', password: '123', isAdmin: false, statusMessage: 'Sedang mencari inspirasi...', avatar: null },
        { id: 'u004', username: 'Nauvalsada Unesa', password: '123', isAdmin: false, statusMessage: 'Lagi fokus belajar.', avatar: null },
        { id: 'u005', username: '+6289534479382', password: '123', isAdmin: false, statusMessage: 'Halo dunia!', avatar: null },
        { id: 'u006', username: 'Gemar Kode', password: '123', isAdmin: false, statusMessage: 'Diskusi tentang teknologi.', avatar: null },
        { id: 'u007', username: 'Suka Koding 2', password: '123', isAdmin: false, statusMessage: 'Membangun sesuatu yang keren.', avatar: null },
        { id: 'u008', username: 'Komunitas IT Indonesia', password: '123', isAdmin: false, statusMessage: 'Berbagi ilmu.', avatar: null },
        { id: 'u009', username: '+6288902885836', password: '123', isAdmin: false, statusMessage: 'Kopi dan kode.', avatar: null },
        { id: 'u010', username: 'PHP Web Developer', password: '123', isAdmin: false, statusMessage: 'Framework favorit: Laravel.', avatar: null },
        { id: 'u011', username: 'Member Baru 1', password: '123', isAdmin: false, statusMessage: 'Hai, saya baru!', avatar: null },
        { id: 'u012', username: 'Member Baru 2', password: '123', isAdmin: false, statusMessage: 'Apa kabar?', avatar: null },
        { id: 'u013', username: 'Member Baru 3', password: '123', isAdmin: false, statusMessage: 'Selamat datang!', avatar: null },
        { id: 'u014', username: 'Tester Admin', password: '123', isAdmin: true, statusMessage: 'Menguji sistem.', avatar: null },
        { id: 'u015', username: 'Guest User', password: '123', isAdmin: false, statusMessage: 'Sedang offline.', avatar: null },
    ];

    let chats = [
        {
            id: 'chat_devtalk',
            name: 'DevTalk Hub 2025',
            lastMessage: 'Nauvalsada Unesa: tt https://vt.tiktok.com/ZSBeAvKpK/',
            timestamp: '15.44',
            unreadCount: 926,
            isGroup: true,
            isAdmin: false,
            avatar: null,
            participants: ['u001', 'u002', 'u003', 'u004', 'u005']
        },
        {
            id: 'chat_kodinglife',
            name: 'KodingLife',
            lastMessage: 'Royalty: ☕ Open murbug Xpreskh Infinity (Versi terbaru) `...',
            timestamp: '15.12',
            unreadCount: 19,
            isGroup: true,
            isAdmin: false,
            avatar: null,
            participants: ['u001', 'u002', 'u006', 'u007']
        },
        {
            id: 'chat_u005', // Direct chat with +62 895-3447-9382
            name: '+62 895-3447-9382',
            lastMessage: 'Wet',
            timestamp: '14.17',
            unreadCount: 0,
            isGroup: false,
            isAdmin: false,
            avatar: null,
            participants: ['u001', 'u005']
        },
        {
            id: 'chat_komunitas_keseluruhan',
            name: 'Komunitas Keseluruhan',
            lastMessage: 'Coding Indonesia ▸ https://chat.whatsapp.com/JRD42HAPeJc...',
            timestamp: '14',
            unreadCount: 14,
            isGroup: true,
            isAdmin: false,
            avatar: null,
            participants: ['u001', 'u008', 'u009']
        },
        {
            id: 'chat_gemar_kode',
            name: 'Gemar Kode | Forum',
            lastMessage: 'Dlimas Alfiansyah: Lucu bang, kalo gk salah itu grup yg isi ny...',
            timestamp: '09.37',
            unreadCount: 2,
            isGroup: true,
            isAdmin: false,
            avatar: null,
            participants: ['u001', 'u003', 'u006']
        },
        {
            id: 'chat_suka_koding2',
            name: 'Suka Koding 2',
            lastMessage: 'CODING PEMULA ▸ +62 823-8639-1006 bergabung menggu...',
            timestamp: '9',
            unreadCount: 9,
            isGroup: false,
            isAdmin: false,
            avatar: null,
            participants: ['u001', 'u007']
        },
        {
            id: 'chat_it_indonesia',
            name: 'Komunitas IT Indonesia',
            lastMessage: 'Pengumuman ▸ Gaes, udah aman kah dari para alomani tujuhh...',
            timestamp: '7',
            unreadCount: 0,
            isGroup: true,
            isAdmin: false,
            avatar: null,
            participants: ['u001', 'u008']
        },
        {
            id: 'chat_annas_self', // Simulating own chat/info
            name: 'Annas',
            lastMessage: 'Anda menggunakan timer default untuk pesan sementara di chat...',
            timestamp: '25/06',
            unreadCount: 0,
            isGroup: false,
            isAdmin: true, // Example: Mark Annas as admin for the badge
            avatar: null,
            participants: ['u001']
        },
        {
            id: 'chat_u009',
            name: '+62 889-0288-5836',
            lastMessage: '',
            timestamp: '24/06',
            unreadCount: 0,
            isGroup: false,
            isAdmin: false,
            avatar: null,
            participants: ['u001', 'u009']
        },
        {
            id: 'chat_php_webdev',
            name: 'PHP Web Developer Indonesia',
            lastMessage: 'PHP Framewok ▸ +62 838-6744-8829 bergabung dari komu...',
            timestamp: '0',
            unreadCount: 0,
            isGroup: true,
            isAdmin: false,
            avatar: null,
            participants: ['u001', 'u010']
        },
        {
            id: 'chat_pppp_1',
            name: 'PPPPP - 1',
            lastMessage: 'Anda yang membuat grup ini',
            timestamp: '0',
            unreadCount: 0,
            isGroup: false,
            isAdmin: false,
            avatar: null,
            participants: ['u001', 'u011']
        }
    ];

    // Sample messages for each chat
    let messages = {
        'chat_annas_self': [
            { senderId: 'info', text: 'Pesan dan panggilan terenkripsi secara end-to-end. Hanya orang di chat ini yang bisa membaca, mendengarkan, atau membagikannya.', type: 'info', timestamp: 'Rabu' },
            { senderId: 'info', text: 'Anda menggunakan timer default untuk pesan sementara di chat baru. Pesan baru akan hilang dari chat ini 24 jam setelah dikirim, kecuali disimpan. Ketuk untuk menyetel timer default Anda sendiri', type: 'info', timestamp: '' },
            { senderId: 'u001', text: 'Halo, ini Annas. Selamat datang di aplikasi chat demo saya!', type: 'text', timestamp: '10.00' }
        ],
        'chat_devtalk': [
            { senderId: 'u004', text: 'tt https://vt.tiktok.com/ZSBeAvKpK/', type: 'text', timestamp: '15.44' },
            { senderId: 'u001', text: 'Wah, link bagus!', type: 'text', timestamp: '15.45' }
        ],
        'chat_kodinglife': [
            { senderId: 'u002', text: '☕ Open murbug Xpreskh Infinity (Versi terbaru) `...', type: 'text', timestamp: '15.12' },
            { senderId: 'u006', text: 'Ada yang sudah coba?', type: 'text', timestamp: '15.15' }
        ],
        'chat_u005': [
            { senderId: 'u005', text: 'Wet', type: 'text', timestamp: '14.17' },
            { senderId: 'u001', text: 'Maksudnya?', type: 'text', timestamp: '14.20' }
        ],
        'chat_komunitas_keseluruhan': [
            { senderId: 'u008', text: 'Coding Indonesia ▸ https://chat.whatsapp.com/JRD42HAPeJc...', type: 'text', timestamp: '14' },
            { senderId: 'u001', text: 'Terima kasih informasinya!', type: 'text', timestamp: '14.05' }
        ],
        'chat_gemar_kode': [
            { senderId: 'u003', text: 'Lucu bang, kalo gk salah itu grup yg isi ny...', type: 'text', timestamp: '09.37' },
            { senderId: 'u006', text: 'Iya, betul sekali!', type: 'text', timestamp: '09.40' }
        ],
        'chat_suka_koding2': [
            { senderId: 'info', text: 'CODING PEMULA ▸ +62 823-8639-1006 bergabung menggu...', type: 'info', timestamp: '9' },
            { senderId: 'u001', text: 'Selamat datang!', type: 'text', timestamp: '09.05' }
        ],
        'chat_it_indonesia': [
            { senderId: 'u008', text: 'Pengumuman ▸ Gaes, udah aman kah dari para alomani tujuhh...', type: 'text', timestamp: '7' },
            { senderId: 'u001', text: 'Aman, min!', type: 'text', timestamp: '07.05' }
        ],
        'chat_u009': [
            { senderId: 'u009', text: '...', type: 'text', timestamp: '24/06' },
            { senderId: 'u001', text: 'Ada apa?', type: 'text', timestamp: '24/06' }
        ],
        'chat_php_webdev': [
            { senderId: 'u010', text: 'PHP Framewok ▸ +62 838-6744-8829 bergabung dari komu...', type: 'text', timestamp: '0' },
            { senderId: 'u001', text: 'Selamat datang di grup PHP!', type: 'text', timestamp: '00.05' }
        ],
        'chat_pppp_1': [
            { senderId: 'info', text: 'Anda yang membuat grup ini', type: 'info', timestamp: '0' },
            { senderId: 'u001', text: 'Halo semuanya!', type: 'text', timestamp: '00.05' }
        ]
    };

    let statuses = [
        { userId: 'u001', username: 'Annas', avatar: null, time: 'Baru saja', isSeen: false, content: 'Semangat ngoding hari ini! #developerlife' },
        { userId: 'u002', username: 'Royalty', avatar: null, time: '10 menit yang lalu', isSeen: true, content: 'Kopi pagi terbaik ☕' },
        { userId: 'u003', username: 'Dlimas Alfiansyah', avatar: null, time: '30 menit yang lalu', isSeen: false, content: 'Mood bagus buat koding hari ini.' },
        { userId: 'u004', username: 'Nauvalsada Unesa', avatar: null, time: '1 jam yang lalu', isSeen: true, content: 'Belajar hal baru setiap hari.' },
        { userId: 'u005', username: '+6289534479382', avatar: null, time: '2 jam yang lalu', isSeen: false, content: 'Jalan-jalan sore.' },
    ];


    let currentUser = null; // Stores logged-in user info
    let activeChatId = null; // To keep track of which chat is open

    // --- DOM Elements ---
    const loadingScreen = document.getElementById('loading-screen');
    const authScreen = document.getElementById('auth-screen');
    const authTitle = document.getElementById('auth-title');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const authSubmitBtn = document.getElementById('auth-submit-btn');
    const toggleAuthLink = document.getElementById('toggle-auth');
    const authMessage = document.getElementById('auth-message');

    const mainChatListScreen = document.getElementById('main-chat-list-screen');
    const chatListContent = document.getElementById('chat-list-content');
    const fabChat = document.getElementById('fab-chat');
    const promoBanner = document.getElementById('promo-banner');
    const promoBannerCloseBtn = promoBanner?.querySelector('.close-btn');

    const individualChatScreen = document.getElementById('individual-chat-screen');
    const chatHeader = document.getElementById('chat-header');
    const chatPartnerNameDisplay = document.getElementById('chat-partner-name-display');
    const chatPartnerStatusDisplay = document.getElementById('chat-partner-status-display');
    const chatPartnerAvatarDisplay = document.getElementById('chat-partner-avatar-display');
    const backToChatsBtn = document.getElementById('back-to-chats');
    const chatMessagesContainer = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');
    const sendMessageBtn = document.getElementById('send-message-btn');
    const callButton = document.getElementById('call-btn'); // Video call button

    const callScreen = document.getElementById('call-screen');
    const callingAvatar = document.getElementById('calling-avatar');
    const callingName = document.getElementById('calling-name');
    const callStatus = document.getElementById('call-status');
    const endCallBtn = document.getElementById('end-call-btn');

    const statusScreen = document.getElementById('status-screen');
    const myStatusAvatar = statusScreen.querySelector('.my-status-avatar');
    const addStatusIcon = myStatusAvatar?.querySelector('.add-status-icon');
    const statusListContainer = document.getElementById('status-list');

    const adminControlScreen = document.getElementById('admin-control-screen');
    const adminNavItem = document.getElementById('admin-nav-item');
    const backFromAdminBtn = document.getElementById('back-from-admin');
    const userManagementList = document.getElementById('user-management-list');
    const newUserUsernameInput = document.getElementById('new-user-username');
    const newUserPasswordInput = document.getElementById('new-user-password');
    const addUserBtn = document.getElementById('add-user-btn');
    const totalUsersStat = document.getElementById('total-users-stat');
    const messagesTodayStat = document.getElementById('messages-today-stat');
    const activeCallsStat = document.getElementById('active-calls-stat');


    // --- Helper Functions ---
    function getInitials(name) {
        if (!name) return '';
        const parts = name.split(' ');
        if (parts.length > 1) {
            return (parts[0][0] + parts[1][0]).toUpperCase();
        }
        return parts[0][0].toUpperCase();
    }

    function showScreen(screenId) {
        const screens = document.querySelectorAll('.app-screen');
        screens.forEach(screen => {
            if (screen.id === screenId) {
                screen.style.display = 'flex'; // Make target visible
                setTimeout(() => {
                    screen.classList.add('active'); // Trigger transition
                }, 10);
            } else {
                screen.classList.remove('active');
                // Give a small delay before hiding to allow transition out
                setTimeout(() => {
                    screen.style.display = 'none';
                }, 400); // Should match CSS transition duration
            }
        });
    }

    function displayAuthMessage(message, isError = true) {
        authMessage.textContent = message;
        authMessage.style.color = isError ? 'var(--danger-color)' : 'var(--success-color)';
        authMessage.style.display = 'block';
        setTimeout(() => {
            authMessage.style.display = 'none';
        }, 3000);
    }

    // --- Authentication Logic ---
    let isLoginMode = true; // State for login/register form

    function toggleAuthMode() {
        isLoginMode = !isLoginMode;
        authTitle.textContent = isLoginMode ? 'Login' : 'Daftar';
        authSubmitBtn.textContent = isLoginMode ? 'Login' : 'Daftar';
        toggleAuthLink.textContent = isLoginMode ? 'Belum punya akun? Daftar di sini' : 'Sudah punya akun? Login di sini';
        usernameInput.value = '';
        passwordInput.value = '';
        authMessage.style.display = 'none';
    }

    function handleAuthSubmit() {
        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();

        if (!username || !password) {
            displayAuthMessage('Username dan password tidak boleh kosong!');
            return;
        }

        if (isLoginMode) {
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                currentUser = user;
                displayAuthMessage(`Selamat datang, ${currentUser.username}!`, false);
                setTimeout(() => {
                    showScreen('main-chat-list-screen');
                    renderChatList();
                    updateAdminControlsVisibility();
                }, 500);
            } else {
                displayAuthMessage('Username atau password salah.');
            }
        } else {
            // Register logic (for demo, just add to users array if unique)
            if (users.some(u => u.username === username)) {
                displayAuthMessage('Username sudah terdaftar. Gunakan yang lain.');
            } else {
                const newUser = {
                    id: 'u' + (users.length + 1).toString().padStart(3, '0'), // Simple ID generation
                    username: username,
                    password: password,
                    isAdmin: false,
                    statusMessage: 'Hai, saya pengguna baru!',
                    avatar: null
                };
                users.push(newUser);
                displayAuthMessage('Pendaftaran berhasil! Silakan login.', false);
                isLoginMode = true; // Switch to login mode after registration
                toggleAuthMode(); // Update UI for login
            }
        }
    }

    // --- Chat List Logic ---
    function renderChatList() {
        chatListContent.innerHTML = ''; // Clear previous list
        // Filter chats to only show those where currentUser is a participant, or all if admin
        const accessibleChats = currentUser?.isAdmin
            ? chats
            : chats.filter(chat => chat.participants.includes(currentUser.id));

        accessibleChats.forEach(chat => {
            const item = document.createElement('div');
            item.classList.add('chat-list-item');
            item.dataset.chatId = chat.id;

            // Determine display name and avatar for direct chats vs groups
            let displayName = chat.name;
            let displayAvatarContent;

            if (chat.isGroup) {
                displayAvatarContent = chat.avatar ? `<img src="${chat.avatar}" alt="${chat.name}" />` : getInitials(chat.name);
            } else {
                // For direct chats, find the other participant's info
                const otherParticipantId = chat.participants.find(id => id !== currentUser.id);
                const otherParticipant = users.find(u => u.id === otherParticipantId);
                if (otherParticipant) {
                    displayName = otherParticipant.username;
                    displayAvatarContent = otherParticipant.avatar ? `<img src="${otherParticipant.avatar}" alt="${otherParticipant.username}" />` : getInitials(otherParticipant.username);
                } else {
                    // Fallback if participant not found (shouldn't happen with proper data)
                    displayAvatarContent = getInitials(chat.name);
                }
            }


            item.innerHTML = `
                <div class="avatar">${displayAvatarContent}</div>
                <div class="chat-info">
                    <div class="chat-name">
                        ${displayName}
                        ${chat.isAdmin ? '<i class="fas fa-check-circle admin-badge"></i>' : ''}
                    </div>
                    <div class="last-message">${chat.lastMessage}</div>
                </div>
                <div class="chat-meta">
                    <span class="timestamp">${chat.timestamp}</span>
                    ${chat.unreadCount > 0 ? `<span class="unread-count">${chat.unreadCount}</span>` : ''}
                </div>
            `;
            chatListContent.appendChild(item);

            item.addEventListener('click', () => openIndividualChat(chat.id));
        });
    }

    // --- Individual Chat Logic ---
    function renderMessages(chatId) {
        chatMessagesContainer.innerHTML = ''; // Clear previous messages
        const chatMessages = messages[chatId] || [];

        chatMessages.forEach(msg => {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message-bubble');

            let senderName = '';
            if (msg.senderId === 'info') {
                messageElement.classList.add('info');
            } else {
                const senderUser = users.find(u => u.id === msg.senderId);
                senderName = senderUser ? senderUser.username : 'Unknown';
                if (msg.senderId === currentUser.id) {
                    messageElement.classList.add('sent');
                } else {
                    messageElement.classList.add('received');
                }
            }

            messageElement.innerHTML = `
                ${msg.type !== 'info' && activeChatId.includes('chat_') ? `<span class="message-sender">${senderName}</span>` : ''}
                <p>${msg.text}</p>
                <span class="message-timestamp">${msg.timestamp}</span>
            `;
            chatMessagesContainer.appendChild(messageElement);
        });
        // Scroll to bottom
        chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
    }

    function sendMessage() {
        const messageText = chatInput.value.trim();
        if (messageText && activeChatId) {
            if (!messages[activeChatId]) {
                messages[activeChatId] = [];
            }
            messages[activeChatId].push({
                senderId: currentUser.id,
                text: messageText,
                timestamp: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                type: 'text'
            });
            chatInput.value = '';
            renderMessages(activeChatId);
        }
    }

    function openIndividualChat(chatId) {
        activeChatId = chatId;
        const chat = chats.find(c => c.id === chatId);
        if (chat) {
            let partnerName = chat.name;
            let partnerAvatarContent;
            let partnerStatus = 'Online';

            if (chat.isGroup) {
                partnerAvatarContent = chat.avatar ? `<img src="${chat.avatar}" alt="${chat.name}" />` : getInitials(chat.name);
                partnerStatus = `${chat.participants.length} Anggota`;
            } else {
                const otherParticipantId = chat.participants.find(id => id !== currentUser.id);
                const otherParticipant = users.find(u => u.id === otherParticipantId);
                if (otherParticipant) {
                    partnerName = otherParticipant.username;
                    partnerAvatarContent = otherParticipant.avatar ? `<img src="${otherParticipant.avatar}" alt="${otherParticipant.username}" />` : getInitials(otherParticipant.username);
                    partnerStatus = otherParticipant.statusMessage || 'Online';
                }
            }

            chatPartnerNameDisplay.textContent = partnerName;
            // Dynamically add admin badge if applicable for the chat itself (e.g. if a group is admin-managed)
            if (chat.isAdmin) {
                if (!chatPartnerNameDisplay.querySelector('.admin-badge')) {
                    const badge = document.createElement('i');
                    badge.classList.add('fas', 'fa-check-circle', 'admin-badge');
                    chatPartnerNameDisplay.appendChild(badge);
                }
            } else {
                const existingBadge = chatPartnerNameDisplay.querySelector('.admin-badge');
                if (existingBadge) existingBadge.remove();
            }

            chatPartnerAvatarDisplay.innerHTML = partnerAvatarContent;
            chatPartnerStatusDisplay.textContent = partnerStatus;

            showScreen('individual-chat-screen');
            renderMessages(chatId);
        }
    }

    // --- Call Screen Logic ---
    function startCall(partnerChatId) {
        let partnerName = 'Unknown';
        let partnerAvatar = '';
        if (partnerChatId) {
            const chat = chats.find(c => c.id === partnerChatId);
            if (chat && !chat.isGroup) { // Only direct calls for now
                const otherParticipantId = chat.participants.find(id => id !== currentUser.id);
                const otherParticipant = users.find(u => u.id === otherParticipantId);
                if (otherParticipant) {
                    partnerName = otherParticipant.username;
                    partnerAvatar = otherParticipant.avatar ? `<img src="${otherParticipant.avatar}" alt="${otherParticipant.username}" />` : getInitials(otherParticipant.username);
                }
            } else if (chat && chat.isGroup) { // For groups, just use group name/avatar
                partnerName = chat.name;
                partnerAvatar = chat.avatar ? `<img src="${chat.avatar}" alt="${chat.name}" />` : getInitials(chat.name);
            }
        }

        callingName.textContent = `Memanggil ${partnerName}...`;
        callingAvatar.innerHTML = partnerAvatar;
        callStatus.textContent = 'Menghubungkan...';
        showScreen('call-screen');

        // Simulate call connection
        setTimeout(() => {
            callStatus.textContent = 'Berdering...';
        }, 2000);
        setTimeout(() => {
            callStatus.textContent = `Panggilan dengan ${partnerName} Berlangsung`;
            activeCallsStat.textContent = parseInt(activeCallsStat.textContent) + 1;
        }, 5000);
    }

    function endCall() {
        alert('Panggilan diakhiri.');
        showScreen('main-chat-list-screen'); // Return to main chat list
        activeCallsStat.textContent = Math.max(0, parseInt(activeCallsStat.textContent) - 1);
    }

    // --- Status Screen Logic ---
    function renderStatusList() {
        statusListContainer.innerHTML = ''; // Clear previous list

        const myStatusUser = users.find(u => u.id === currentUser.id);
        if (myStatusUser) {
            myStatusAvatar.innerHTML = myStatusUser.avatar ? `<img src="${myStatusUser.avatar}" alt="${myStatusUser.username}" />` : getInitials(myStatusUser.username);
            myStatusAvatar.querySelector('.add-status-icon').style.display = 'flex'; // Ensure plus icon is visible
            myStatusAvatar.nextElementSibling.querySelector('h3').textContent = 'Status Saya';
            myStatusAvatar.nextElementSibling.querySelector('p').textContent = myStatusUser.statusMessage || 'Ketuk untuk memperbarui status';
        }

        const recentStatuses = statuses.filter(s => s.userId !== currentUser.id); // Exclude own status for 'Recent Updates'
        if (recentStatuses.length === 0) {
            statusListContainer.innerHTML = '<p style="text-align: center; color: var(--text-muted); margin-top: 30px;">Tidak ada pembaruan status terbaru.</p>';
            return;
        }

        recentStatuses.forEach(status => {
            const user = users.find(u => u.id === status.userId);
            if (!user) return; // Skip if user not found

            const item = document.createElement('div');
            item.classList.add('status-item');
            item.dataset.userId = user.id;

            const avatarContent = user.avatar ? `<img src="${user.avatar}" alt="${user.username}" />` : getInitials(user.username);
            const statusClass = status.isSeen ? '' : 'unseen';

            item.innerHTML = `
                <div class="status-avatar ${statusClass}">${avatarContent}</div>
                <div class="status-info">
                    <div class="status-name">${user.username}</div>
                    <div class="status-time">${status.time}</div>
                </div>
            `;
            statusListContainer.appendChild(item);

            item.addEventListener('click', () => viewStatus(user.id, status.content));
        });
    }

    function viewStatus(userId, content) {
        alert(`Status dari ${users.find(u => u.id === userId)?.username}:\n\n"${content}"\n\n(Simulasi: Klik OK untuk melihat status selanjutnya atau keluar.)`);
        // In a real app, this would open a full-screen status viewer
        // Mark status as seen (for demo, just update the local data)
        const statusToUpdate = statuses.find(s => s.userId === userId);
        if (statusToUpdate) {
            statusToUpdate.isSeen = true;
            renderStatusList(); // Re-render to update seen/unseen circle
        }
    }

    // --- Admin Control Logic ---
    function updateAdminControlsVisibility() {
        if (currentUser && currentUser.isAdmin) {
            adminNavItem.style.display = 'flex';
        } else {
            adminNavItem.style.display = 'none';
        }
    }

    function renderUserManagementList() {
        userManagementList.innerHTML = ''; // Clear list
        users.forEach(user => {
            if (user.id === currentUser.id) return; // Don't allow managing self

            const item = document.createElement('div');
            item.classList.add('admin-list-item');
            item.innerHTML = `
                <div class="user-info">
                    <div class="avatar">${user.avatar ? `<img src="${user.avatar}" />` : getInitials(user.username)}</div>
                    <span class="username">${user.username} ${user.isAdmin ? '(Admin)' : ''}</span>
                </div>
                <div class="admin-actions">
                    <button class="promote" data-user-id="${user.id}">${user.isAdmin ? 'Demote' : 'Promote'}</button>
                    <button class="delete" data-user-id="${user.id}">Hapus</button>
                </div>
            `;
            userManagementList.appendChild(item);
        });

        // Add event listeners after rendering
        userManagementList.querySelectorAll('.admin-actions .promote').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const userId = e.target.dataset.userId;
                toggleUserAdminStatus(userId);
            });
        });
        userManagementList.querySelectorAll('.admin-actions .delete').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const userId = e.target.dataset.userId;
                deleteUser(userId);
            });
        });
    }

    function addUser() {
        const username = newUserUsernameInput.value.trim();
        const password = newUserPasswordInput.value.trim();

        if (!username || !password) {
            alert('Username dan password pengguna baru tidak boleh kosong!');
            return;
        }
        if (users.some(u => u.username === username)) {
            alert('Username ini sudah ada.');
            return;
        }

        const newUser = {
            id: 'u' + (users.length + 1).toString().padStart(3, '0'),
            username: username,
            password: password,
            isAdmin: false,
            statusMessage: 'Pengguna baru!',
            avatar: null
        };
        users.push(newUser);
        newUserUsernameInput.value = '';
        newUserPasswordInput.value = '';
        alert('Pengguna baru berhasil ditambahkan!');
        renderUserManagementList();
        updateAdminStats();
    }

    function toggleUserAdminStatus(userId) {
        const userIndex = users.findIndex(u => u.id === userId);
        if (userIndex > -1) {
            users[userIndex].isAdmin = !users[userIndex].isAdmin;
            alert(`${users[userIndex].username} sekarang ${users[userIndex].isAdmin ? 'adalah Admin' : 'bukan Admin lagi'}.`);
            renderUserManagementList();
        }
    }

    function deleteUser(userId) {
        if (confirm(`Apakah Anda yakin ingin menghapus pengguna ini? Ini tidak dapat diurungkan.`)) {
            const initialUserCount = users.length;
            users = users.filter(user => user.id !== userId);
            if (users.length < initialUserCount) {
                alert('Pengguna berhasil dihapus.');
                // Also remove any chats they were the sole participant of (simplified)
                chats = chats.filter(chat => !chat.participants.includes(userId) || chat.participants.length > 1);

                renderUserManagementList();
                updateAdminStats();
                if (activeChatId && activeChatId === userId) {
                    showScreen('main-chat-list-screen'); // If active chat was with deleted user
                }
            } else {
                alert('Gagal menghapus pengguna.');
            }
        }
    }

    function updateAdminStats() {
        totalUsersStat.textContent = users.length;
        // These are very basic simulations
        messagesTodayStat.textContent = Math.floor(Math.random() * 500) + 100; // Random number
        // activeCallsStat is updated by call functions
    }

    // --- Event Listeners ---
    authSubmitBtn.addEventListener('click', handleAuthSubmit);
    toggleAuthLink.addEventListener('click', toggleAuthMode);
    promoBannerCloseBtn?.addEventListener('click', function() {
        this.closest('#promo-banner').style.display = 'none';
    });
    fabChat.addEventListener('click', () => {
        alert('Fitur "Buat Chat Baru" belum diimplementasikan sepenuhnya. Anda bisa menambahkan logika untuk memilih kontak di sini.');
    });
    backToChatsBtn.addEventListener('click', () => {
        showScreen('main-chat-list-screen');
        activeChatId = null;
        renderChatList(); // Refresh chat list
    });
    sendMessageBtn.addEventListener('click', sendMessage);
    chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });

    callButton.addEventListener('click', () => {
        // Find the user/group ID from the current active chat
        if (activeChatId) {
            startCall(activeChatId);
        } else {
            alert('Pilih chat untuk memulai panggilan.');
        }
    });
    endCallBtn.addEventListener('click', endCall);

    myStatusAvatar?.addEventListener('click', () => {
        alert('Ketuk untuk memperbarui status Anda. (Fitur ini dapat dikembangkan untuk mengunggah gambar/teks status)');
    });
    addStatusIcon?.addEventListener('click', (e) => {
        e.stopPropagation(); // Prevent myStatusAvatar click event
        alert('Tambah status baru! (Anda bisa menambahkan logika untuk membuat status baru di sini)');
    });


    // Admin controls
    backFromAdminBtn.addEventListener('click', () => {
        showScreen('main-chat-list-screen');
    });
    addUserBtn.addEventListener('click', addUser);

    // Bottom navigation
    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function() {
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            this.classList.add('active');

            const targetScreenId = this.dataset.screen;
            if (targetScreenId === 'main-chat-list-screen') {
                showScreen('main-chat-list-screen');
                renderChatList();
            } else if (targetScreenId === 'call-screen-nav') {
                 // For now, if no active chat, just show call screen as "idle"
                startCall(null); // Pass null to indicate not calling a specific chat yet
            } else if (targetScreenId === 'status-screen') {
                showScreen('status-screen');
                renderStatusList();
            } else if (targetScreenId === 'admin-control-screen') {
                if (currentUser && currentUser.isAdmin) {
                    showScreen('admin-control-screen');
                    renderUserManagementList();
                    updateAdminStats();
                } else {
                    alert('Anda tidak memiliki akses admin!');
                    // Revert active state if not admin
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    document.querySelector('.nav-item[data-screen="main-chat-list-screen"]').classList.add('active');
                }
            }
        });
    });


    // --- Initial Load Logic ---
    document.addEventListener('DOMContentLoaded', () => {
        // Simulate initial loading
        loadingScreen.classList.add('show');
        const consoleText = `
Connecting to Annas Chat Server...
Authenticating user session...
Loading secure modules...
Establishing encrypted connection...
Initialization complete.
Access Granted.
`;
        const consoleElement = document.querySelector('.hacker-console');
        consoleElement.textContent = ''; // Clear existing text

        let i = 0;
        const speed = 30; // typing speed
        function typeWriter() {
            if (i < consoleText.length) {
                consoleElement.textContent += consoleText.charAt(i);
                i++;
                setTimeout(typeWriter, speed);
            } else {
                setTimeout(() => {
                    loadingScreen.style.opacity = '0';
                    loadingScreen.addEventListener('transitionend', () => {
                        loadingScreen.style.display = 'none';
                        showScreen('auth-screen'); // Show auth screen after loading
                    }, { once: true });
                }, 1000); // Wait a bit after typing finishes
            }
        }
        typeWriter();
    });
  </script>
</body>
</html>